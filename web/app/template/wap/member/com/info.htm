{yun:}include file="$wapstyle/member/cheader.htm"{/yun}
<link rel="stylesheet" type="text/css" href="{yun:}$wap_style{/yun}/js/webapppic/cropper.css?v={yun:}$config.cachecode{/yun}"/>
<script src="{yun:}$wap_style{/yun}/js/alloy/transform.js?v={yun:}$config.cachecode{/yun}" language="javascript"></script>
<script src="{yun:}$wap_style{/yun}/js/alloy/alloy-finger.js?v={yun:}$config.cachecode{/yun}" language="javascript"></script>
<script src="{yun:}$wap_style{/yun}/js/alloy-crop.js?v={yun:}$config.cachecode{/yun}" language="javascript"></script>
<script src="{yun:}$wap_style{/yun}/js/compress.js?v={yun:}$config.cachecode{/yun}" language="javascript"></script>
<script src="{yun:}$wap_style{/yun}/js/exif.js?v={yun:}$config.cachecode{/yun}" language="javascript"></script>

<!-- 页面整体部分 -->
<div id="yunvue" class="none">

    <div class="issue_post_body">
        <form onsubmit="return formSubmitinfo(this)">
            <div class="issue_post_body_card">
                <div class="post_body_card_job">
                    <div class="body_card_job_box">
                        <div class="card_job_box_post">企业logo</div>
                        <div class="card_job_box_name" @click="openPhoto">上传logo赢更多曝光机会</div>
                    </div>
                    <div class="body_card_job_logo" @click="openPhoto">
                        <img :src="logo" alt="">
                    </div>
                </div>
                <div class="post_body_card_job">
                    <div class="body_card_job_box">
                        <div class="card_job_box_post">企业名称</div>
						<div style="color: #c9c5c5;" v-if="cominfo.yyzz_status==1"> {{cominfo.name}}
                            <input name="name" v-model="cominfo.name" type="hidden">
                        </div>
                        <div v-if="cominfo.yyzz_status!=1">
                            <input name="name" v-model="cominfo.name" placeholder="请输入企业全称" type="text">
                        </div>
                    </div>
                  
                </div>
                <div class="post_body_card_job">
                    <div class="body_card_job_box">
                        <div class="card_job_box_post">从事行业</div>
                        <div class="card_job_box_name_require" @click="hyShow=true">{{hy.name[hyIndex]}}</div>
                        <van-popup v-model="hyShow" position="bottom"/>
                        <van-picker show-toolbar :default-index="hyIndex" @cancel="hyShow = false" :columns="hy.name" @confirm="bindhyChange"/></van-popup>
                        <input hidden="true" name="hy" :value="cominfo.hy?cominfo.hy:0"/>
                    </div>
                    <div class="body_card_job_icon">
                        <img src="{yun:}$wap_style{/yun}/images/issue_add.png" alt="">
                    </div>
                </div>
                <div class="post_body_card_job">
                    <div class="body_card_job_box">
                        <div class="card_job_box_post">企业性质</div>
                        <div class="card_job_box_name_require" @click="prShow=true">{{pr.name[prIndex]}}</div>
                        <van-popup v-model="prShow" position="bottom"/>
                        <van-picker show-toolbar :default-index="prIndex" @cancel="prShow = false" :columns="pr.name" @confirm="bindprChange"/></van-popup>
                        <input hidden="true" name="pr" :value="cominfo.pr?cominfo.pr:0"/>
                    </div>
                    <div class="body_card_job_icon">
                        <img src="{yun:}$wap_style{/yun}/images/issue_add.png" alt="">
                    </div>
                </div>
                <div class="post_body_card_job">
                    <div class="body_card_job_box">
                        <div class="card_job_box_post">企业规模</div>
                        <div class="card_job_box_name_require" @click="munShow=true">{{mun.name[munIndex]}}</div>
                        <van-popup v-model="munShow" position="bottom"/>
                        <van-picker show-toolbar :default-index="munIndex" @cancel="munShow = false" :columns="mun.name" @confirm="bindmunChange"/></van-popup>
                        <input hidden="true" name="mun" :value="cominfo.mun?cominfo.mun:0"/>
                    </div>
                    <div class="body_card_job_icon">
                        <img src="{yun:}$wap_style{/yun}/images/issue_add.png" alt="">
                    </div>
                </div>
                <div class="post_body_card_job">
                    <div class="body_card_job_box">
                        <div class="card_job_box_post">工作地点</div>
                        <div class="card_job_box_location" @click="openAddress">
                            {{city}}
                        </div>
                    </div>
                    <div class="body_card_job_icon" @click="openAddress">
                        <img src="{yun:}$wap_style{/yun}/images/issue_location.png" alt="">
                    </div>
                </div>
                <div class="post_body_card_job">
                    <div class="body_card_job_box">
                        <div class="card_job_box_post">联系人</div>
                        <div class="card_job_box_name">
                            <input name="linkman" placeholder="请输入联系人" v-model="cominfo.linkman"/>
                        </div>
                    </div>
                    <div class="body_card_job_icon">

                    </div>
                </div>
                <div class="post_body_card_job post_body_card_job_pv">
                    <div class="body_card_job_box">
                        <div class="card_job_box_post">手机号</div>
						<div style="color: #c9c5c5;"v-if="cominfo.moblie_status == 1">{{cominfo.linktel}}
                            <input name="linktel" v-model="cominfo.linktel" type="hidden"/>
                        </div>
                        <div v-if="cominfo.moblie_status != 1">
                            <input name="linktel" placeholder="请输入联系手机" v-model="cominfo.linktel" type="number" maxlength="11"  />
                        </div>
                    </div>
                    <div class="body_card_job_icon">
                    </div>
                </div>
                <div class="post_body_card_job">
                    <div class="body_card_job_box">
                        <div class="card_job_box_post">固定电话</div>
                        <div class="card_job_box_name_require">
                            <input name="linkphone" placeholder="请填写固定电话" v-model="cominfo.linkphone"/>
                        </div>
                    </div>
                    <div class="body_card_job_icon">
                    </div>
                </div>
                <div class="post_body_card_job">
                    <div class="body_card_job_box">
                        <div class="card_job_box_post">公司简介</div>
                        <div class="card_job_box_require" @click="openDec=true">
                            {{cominfo.content_t ? cominfo.content_t : '请对企业进行介绍~'}}
                        </div>
                    </div>
                    <div class="body_card_job_icon">
                        <img src="{yun:}$wap_style{/yun}/images/issue_add.png" alt="">
                    </div>
                </div>
                <div class="post_body_card_job" @click="supInfoShow=true">
                    <div class="body_card_job_box">
                        <div class="card_job_box_post">补充信息</div>
                        <div class="card_job_box_name">让求职者更好的了解企业</div>
                    </div>
                    <div class="body_card_job_icon">
                        <img src="{yun:}$wap_style{/yun}/images/issue_add.png" alt="">
                    </div>
                </div>
            </div>
            <div class="security_bth">
                <button type="submit" class="security_bth_but">保 存</button>
            </div>
        </form>
    </div>

    <van-popup v-model="photoShow" position="right" :style="{ height: '100%',width:'100%',backgroundColor:'#f3f3f3'}">

        <div class="comheader">
            <a class="comheader_return" @click="photoShow = false"></a>
            <div class="comheader_tit">企业LOGO</div>
        </div>
        <div class="verify">
            <div class="photo_i_box_v">
                <div class="photo_i_box_v_c">
                    <div id="showResult">
                        <div id="changeAvatar" class="photo_i_box">
                            <img :src="newLogo ? newLogo :logo"
                                 onerror="showImgDelay(this,'{yun:}$config.sy_ossurl{/yun}/{yun:}$config.sy_unit_icon{/yun}',2);"
                                 width="120" height="120">
                        </div>
                        <div class="clear"></div>
                        <div class="photo_xz">
                            <input id="image" type="file" accept="image/*" onchange="photoChange(this)"/> 选择上传logo

                        </div>
                        <div class="yunset_identity_msg"><i class="yunset_identity_msg_icon"></i>选择上传logo点击提交按钮即可上传
                            <span v-if="cominfo.logo_n">
                                (
                                <font v-if="cominfo.logo_status == '1'" color="red">审核中</font>
                                <font v-else-if="cominfo.logo_status == '2'" color="red">未通过</font>
                                <font v-else color="red">已审核</font>
                                )
                            </span>
                        </div>
                    </div>

                    <input type="hidden" value="" id="preview">
                </div>
                <div class="photo_tj">
                    <input name="submit" type="button" onclick="photo()" value="提交" class="yunset_bth"/>
                </div>
            </div>
        </div>
    </van-popup>

    <van-popup v-model="addressShow" position="bottom">
        <!--<div class="comheader">-->
        <!--    <a class="comheader_return" @click="addressShow = false"></a>-->
        <!--    <div class="comheader_tit">工作地点</div>-->
        <!--</div>-->
        <div class="issue_post_body">
            <form onsubmit="return jobAddress(this)">
                <div class="issue_post_body_card">
                    <div class="post_body_card_job">
                        <div class="body_card_job_box">
                            <div class="card_job_box_post">所在地区</div>
                            <div class="card_job_box_name_require" @click="areaShow=true">{{city}}</div>
                            <input hidden="true" name="provinceid" :value="provinceid"/>
                            <input hidden="true" name="cityid" :value="cityid"/>
                            <input hidden="true" name="three_cityid" :value="threecityid"/>
                        </div>
                        <div class="body_card_job_icon">
                            <img src="{yun:}$wap_style{/yun}/images/issue_add.png" alt="">
                        </div>
                    </div>
                    <div class="post_body_card_job">
                        <div class="body_card_job_box">
                            <div class="card_job_box_post">详细地址</div>
                            <div class="card_job_box_name">
                                <input placeholder="请输入企业详细地址" v-model="address" id="address" name="address"/>
                            </div>
                        </div>
                        <div class="body_card_job_icon">

                        </div>
                    </div>
                    <div class="post_body_card_job">
                        <div class="body_card_job_box" style="font-size: .4rem;">
                            请单击地图完成地址标记
                        </div>
                        <div class="body_card_job_icon">
                            <img src="{yun:}$wap_style{/yun}/images/issue_location.png" alt="">
                        </div>
                    </div>
                    <div class="post_body_card_job">
                        <div id="map_container"
                             style="width:100%;height:280px;overflow: hidden;margin:0;font-family:'微软雅黑';"></div>
                    </div>
                </div>
                <div class="security_bth">
                    <button type="submit" class="security_bth_but">确 定</button>
                </div>
            </form>
        </div>
    </van-popup>

    <van-popup v-model="openDec" position="right" @open="opendDec"
               :style="{ height: '100%',width:'100%',backgroundColor:'#f3f3f3'}">
        <div class="comheader">
            <a class="comheader_return" @click="openDec = false"></a>
            <div class="comheader_tit">企业简介</div>
        </div>
        <div class="issue_post_body">
            <div class="issue_post_body_card">
                <textarea :class="isTextarea?'none':''" id="content" placeholder="请对企业进行介绍~" maxlength="-1"
                          style="width:100%;height: 400px;" name="description" :value="cominfo.content"></textarea>
            </div>
            <div class="security_bth">
                <button type="submit" class="security_bth_but" @click="upDesc">保 存</button>
            </div>
        </div>
    </van-popup>

    <!--城市选择-->
    <van-popup v-model="areaShow" round position="bottom">
        <van-cascader v-model="areaValue" title="请选择工作区域" :options="areaOptions" @close="areaShow = false"
                      @finish="onAreaFinish"/>
    </van-popup>

    <van-popup v-model="supInfoShow" position="right" :style="{ height: '100%',width:'100%',backgroundColor:'#f3f3f3'}">
        <div class="comheader">
            <a class="comheader_return" @click="supInfoShow = false"></a>
            <div class="comheader_tit">补充信息</div>
        </div>
        <!--补充信息弹出-->
        <div class="issue_post_body">
            <form onsubmit="return formSubmit(this)">
                <div class="warning_title">以下内容均为非必填项，请自主填写</div>
                <div class="issue_post_body_card">
                    <div class="post_body_card_job">
                        <div class="body_card_job_box">
                            <div class="card_job_box_post">企业简称</div>
                            <div class="card_job_box_name_require">
                                <input name="shortname" placeholder="请输入企业简称" v-model="cominfo.shortname"/>
                            </div>
                        </div>
                        <div class="body_card_job_icon">

                        </div>
                    </div>
                    <div class="post_body_card_job">
                        <div class="body_card_job_box">
                            <div class="card_job_box_post">公司福利</div>
                            <div class="card_job_box_name" @click="gsflShow=true">
                                {{welfareval ? welfareval : '请选择公司福利'}}
                            </div>
                            <input name="welfare" :value="welfareval?welfareval:''" hidden="true"/>
                        </div>
                        <div class="body_card_job_icon">
                            <img src="{yun:}$wap_style{/yun}/images/issue_add.png" alt="">
                        </div>
                    </div>
                    <div class="post_body_card_job">
                        <div class="body_card_job_box">
                            <div class="card_job_box_post">企业邮箱</div>
                            <div class="card_job_box_name_require">
                                <input name="linkmail" placeholder="请输入企业邮箱" v-model="cominfo.linkmail" :disabled="cominfo.email_status==1" />
                                <div class="Binding_state" v-if="cominfo.email_status == 1">已验证</div>
                            </div>
                        </div>
                        <div class="body_card_job_icon">
                        </div>
                    </div>
                    <div class="post_body_card_job">
                        <div class="body_card_job_box">
                            <div class="card_job_box_post">传二维码</div>
                            <div @click="upComqcode" class="card_job_box_name">请上传二维码
                                <input type="file" id="pic" name="pic" onchange="previewImage(this,'comqcode')" accept="image/*" value="" style="opacity:0;position: relative;left: -2.9rem;"/>
                                <input type='hidden' name='preview' value='' id='comqcode'>
                            </div>
                        </div>
                        <div @click="upComqcode" class="body_card_job_icon" id="comqcodeshow">
                            <img id="comqcodeimg" onerror="showImgDelay(this,'{yun:}$config.sy_weburl{/yun}/{yun:}$config.sy_member_ewm{/yun}',2);" :src="cominfo.comqcode" alt="">
                        </div>
                    </div>
                    <div class="post_body_card_job">
                        <div class="body_card_job_box">
                            <div class="card_job_box_post">企业网址</div>
                            <div class="card_job_box_name_require">
                                <input name="website" placeholder="请输入企业网址" v-model="cominfo.website"/>
                            </div>
                        </div>
                        <div class="body_card_job_icon">
                        </div>
                    </div>
                    <div class="post_body_card_job">
                        <div class="body_card_job_box">
                            <div class="card_job_box_post">联系方式</div>
                            <div class="card_job_box_name_require" @click="lxfsShow=true">
                                {{infostatus.name[infostatusIndex]}}
                            </div>
                            <input hidden="true" name="infostatus" :value="cominfo.infostatus"/>
                        </div>
                        <div class="body_card_job_icon">
                            <img src="{yun:}$wap_style{/yun}/images/issue_add.png" alt="">
                        </div>
                    </div>
                    <div class="post_body_card_job">
                        <div class="body_card_job_box">
                            <div class="card_job_box_post">您的职位</div>
                            <div class="card_job_box_name">
                                <input name="linkjob" placeholder="请输入你在公司的职位" v-model="cominfo.linkjob"/>
                            </div>
                        </div>
                        <div class="body_card_job_icon">

                        </div>
                    </div>
                    <div class="post_body_card_job">
                        <div class="body_card_job_box">
                            <div class="card_job_box_post">联系QQ</div>
                            <div class="card_job_box_name_require">
                                <input name="linkqq" placeholder="请输入联系QQ" v-model="cominfo.linkqq" type="number"/>
                            </div>
                        </div>
                        <div class="body_card_job_icon">

                        </div>
                    </div>
                    <div class="post_body_card_job">
                        <div class="body_card_job_box">
                            <div class="card_job_box_post">公交站点</div>
                            <div class="card_job_box_name_require">
                                <input name="busstops" v-model="cominfo.busstops" placeholder="输入公交站点"/>
                            </div>
                        </div>
                        <div class="body_card_job_icon">

                        </div>
                    </div>
                    <div class="post_body_card_job">
                        <div class="body_card_job_box">
                            <div class="card_job_box_post">创办时间</div>
                            <div class="card_job_box_name_require" @click="foundedYearShow = true">
                                {{!dateValue&&!cominfo.sdate?'请选择':dateValue?dateValue+'年':cominfo.sdate+'年'}}
                            </div>
                            <input hidden="true" name="sdate" :value="dateValue?dateValue:cominfo.sdate"/>
                        </div>
                        <div class="body_card_job_icon">
                            <img src="{yun:}$wap_style{/yun}/images/issue_add.png" alt="">
                        </div>
                    </div>
                    <div class="post_body_card_job">
                        <div class="body_card_job_box">
                            <div class="card_job_box_post">注册资金</div>
                            <div class="card_job_box_location">
                                <span @click="moneyShow=true">{{moneytype.name[moneytypeIndex]}}</span>

                                <input hidden="true" name="moneytype" :value="cominfo.moneytype"/>
                                <input type="number" name="money" placeholder="请输入注册资金" v-model="cominfo.money" style="width: 80px;text-align: right;"/>
                                <span class="">万元</span>
                            </div>
                        </div>
                        <div class="body_card_job_icon">
                            <img src="{yun:}$wap_style{/yun}/images/issue_add.png" alt="">
                        </div>
                    </div>
                </div>
                <div class="security_bth">
                    <button type="submit" class="security_bth_but">保 存</button>
                </div>
            </form>
        </div>
    </van-popup>

    <!--公司福利-->
    <van-popup v-model="gsflShow" position="bottom" :closeable="true" @close="gsflShow=false" round>
        <div class="yun_jobadd_touch">
            <div class="jstextarea_tck_c_between">
                <div class="xztextarea_tck_tit">福利待遇</div>
            </div>
            <span v-for="(item, welfarekey) in welfareall" :key="welfarekey">
                <span :class="item.ischecked==1 ? 'flbutton_tab':''" class="flbutton_tabh" @click="bindwelfareChang" :data-index="welfarekey" :id="'w' + (welfarekey + 1)">{{item.name}}</span>
            </span>
            <div class="fl_textbox welfare_box">
                <span class="fl_text welfare_laft">
                    <input type="text" v-model="welfareAdd" name="addwelfare" placeholder="输入福利名称"/>
                </span>
                <span class="fl_but welfare_right">
                    <input type="button" value="添加" @click="bindwelfareAdd"/>
                </span>
            </div>
            <div class="lag_text_qd">
                <div class="lag_text_qd_bth" @click="gsflShow = false">确认</div>
            </div>
        </div>

    </van-popup>
    <!--联系方式-->
    <van-popup v-model="lxfsShow" position="bottom">
        <van-picker show-toolbar :default-index="infostatusIndex" @cancel="lxfsShow = false" :columns="infostatus.name" @confirm="bindinfostatusChange"/>
    </van-popup>
    <!--注册资金-->
    <van-popup v-model="moneyShow" position="bottom">
        <van-picker show-toolbar :default-index="moneytypeIndex" @cancel="moneyShow = false" :columns="moneytype.name" @confirm="bindmoneytypeChange"/>
    </van-popup>
    <!--创办时间-->
    <van-popup v-model="foundedYearShow" position="bottom">
        <van-picker show-toolbar :default-index="foundedYearIndex" @cancel="foundedYearShow = false" :columns="foundedYear" @confirm="bindFoundedYear"/>
    </van-popup>
</div>

<link rel="stylesheet" href="{yun:}$wap_style{/yun}/js/umeditor/themes/default/css/umeditor.min.css?v={yun:}$config.cachecode{/yun}" type="text/css"/>
<script src="{yun:}$wap_style{/yun}/js/umeditor/umeditor.config.js?v={yun:}$config.cachecode{/yun}"></script>
<script src="{yun:}$wap_style{/yun}/js/umeditor/umeditor.min.js?v={yun:}$config.cachecode{/yun}"></script>
<script src="{yun:}$wap_style{/yun}/js/jsMath.js?v={yun:}$config.cachecode{/yun}" language="javascript"></script>
<script type="text/javascript" src="{yun:}$config.mapurl{/yun}"></script>
<script src="{yun:}$plusstyle{/yun}/city.cache.js?v={yun:}$config.cachecode{/yun}" language="javascript"></script>
<script src="{yun:}$wap_style{/yun}/js/category.js?v={yun:}$config.cachecode{/yun}" language="javascript"></script>
<script src="{yun:}$plusstyle{/yun}/industry.cache.js?v={yun:}$config.cachecode{/yun}"></script>
<script src="{yun:}$plusstyle{/yun}/com.cache.js?v={yun:}$config.cachecode{/yun}"></script>
<script src="{yun:}$wap_style{/yun}/js/comPicker.js?v={yun:}$config.cachecode{/yun}"></script>

<script>
    var spid = '{yun:}$spid{/yun}';
    var umeditor = {};
    var cityParam = {
        sy_web_city_one: '{yun:}$config.sy_web_city_one{/yun}',
        sy_web_city_two: '{yun:}$config.sy_web_city_two{/yun}',
        one_all: false,
        two_all: false,
    };
    var cityData = cityCategory(cityParam);
    var map = {},
        local;
    var yunvue = new Vue({
            el: '#yunvue',
            data: {
                spid: spid == '' ? spid : 0,
                signstate: 0,

                islook: false,
                logo: '',
                photoShow: false,
                newLogo: '',
                cominfo: {},
                hy: {
                    id: [],
                    name: []
                },
                hyIndex: 0,
                pr: {
                    id: [],
                    name: []
                },
                prIndex: 0,
                mun: {
                    id: [],
                    name: []
                },
                munIndex: 0,

                // 工作地点选择
                areaShow: false,
                areaValue: 0,
                areaName: '',
                areaOptions: cityData,
                city: '请选择所在城市',
                provinceid: 0,
                cityid: 0,
                threecityid: 0,
                setPosition: 0,
                latitude: '',
                longitude: '',
                address: '',

                firstData: {},
                supplementData: {},
                dateValue: '',
                comqcode: '',
                moneytype: {
                    id: [1, 2],
                    name: ['人民币', '美元']
                },
                moneytypeIndex: 1,
                infostatus: {
                    id: [1, 2],
                    name: ['公开', '不公开']
                },
                infostatusIndex: 0,
                welfare: [],
                welfareval: '',
                welfareall: [],
                welfareAdd: '',
                editorCtx: null,
                canEditor: true,
                sdateArr: [0],
                nowtype: '',
                isTextarea: false,
                descshow: false,
                welid: 'w1',

                hyShow: false,
                prShow: false,
                munShow: false,
                addressShow: false,
                supInfoShow: false,
                lxfsShow: false,
                moneyShow: false,
                openDec: false,
                gsflShow: false,

                // 创办时间
                foundedYearShow: false,
                foundedYear: [],
                foundedYearIndex: 0

            },
            created() {

                this.hy = getHy('请选择从事行业');
                this.pr = getPr(); // 企业性质
                this.pr.id.unshift(0)
                this.pr.name.unshift('请选择企业性质')
                this.mun = getMun();// 企业规模
                this.mun.id.unshift(0)
                this.mun.name.unshift('请选择企业规模')
                this.foundedYear = getFoundedYear(); // 获取创办年

                this.comInfo();
            },
            watch: {
                address: function (value) {
                    this.cominfo.address = value;
                    debounce(this.localsearch());
                },
            },
            methods: {
                // 工作区域选择
                onAreaFinish({selectedOptions}) {
                    this.provinceid = 0;
                    this.cityid = 0;
                    this.threecityid = 0;

                    let cityStr = '';

                    if (selectedOptions[0] && selectedOptions[0].value > 0) {
                        if (selectedOptions[0]) {
                            this.provinceid = selectedOptions[0].value;
                            cityStr += selectedOptions[0].text;
                            this.areaName = selectedOptions[0].text;
                        }
                    }
                    if (selectedOptions[1] && selectedOptions[1].value > 0) {
                        if (selectedOptions[1]) {
                            this.cityid = selectedOptions[1].value;
                            cityStr += ' ' + selectedOptions[1].text;
                            this.areaName = selectedOptions[0].text;
                        }
                    }
                    if (selectedOptions[2] && selectedOptions[2].value > 0) {
                        if (selectedOptions[1]) {
                            this.threecityid = selectedOptions[2].value;
                            cityStr += ' ' + selectedOptions[2].text;
                        }
                    }
                    this.city = cityStr ? cityStr : citydefault;
                    this.areaShow = false;
                },
                localsearch: function () {
                    let city = this.areaName
                    let that = this;
                    if (that.cominfo.address == "") {
                        showToast('请输入详细地址！', 2);
                        return false;
                    }
                    local = new BMap.LocalSearch(map, {
                        renderOptions: {
                            map: map,
                            panel: "r-result",
                            autoViewport: true,
                            selectFirstResult: false
                        },
                        onSearchComplete: that.getLocalResult
                    });
                    local.search(this.city + that.cominfo.address);
                },
                getLocalResult: function () {
                    let that = this;

                    var address = that.cominfo.address;
                    var points = local.getResults();

                    if (points.getPoi(0)) {

                        var lngLat = points.getPoi(0).point;
                        that.setLocation('map_container', lngLat.lng, lngLat.lat);

                        that.latitude = lngLat.lat;
                        that.longitude = lngLat.lng;
                    } else {

                        // 解决移动端 click事件点击无效
                        map.addEventListener("touchmove", function (e) {
                            map.enableDragging();
                        });
                        //  触摸结束时触发次此事件  此时开启禁止拖动
                        map.addEventListener("touchend", function (e) {
                            map.disableDragging();
                        });
                        // 初始化地图 禁止拖动   注：虽禁止拖动，但是可以出发拖动事件
                        map.disableDragging();

                        // map.addEventListener("click", function (e) {
                        //     var info = new BMap.InfoWindow('', {
                        //         width: 260
                        //     });
                        //     var projection = this.getMapType().getProjection();
                        //     var lngLat = e.point;
                        //
                        //     that.latitude = lngLat.lat;
                        //     that.longitude = lngLat.lng;
                        //
                        //     map.clearOverlays();
                        //     var point = new BMap.Point(lngLat.lng, lngLat.lat);
                        //     var marker = new BMap.Marker(point);
                        //     map.addOverlay(marker);
                        // });
                        showToast('该地址未搜索到！', 2);
                        return false;
                    }
                },
                setLocation: function (id, x, y) {
                    let that = this;
                    var rating, map_control_type, map_control_anchor;
                    if (!x && !y) {
                        x = '116.404';
                        y = '39.915';
                    }
                    var point = new BMap.Point(x, y);
                    var marker = new BMap.Marker(point);
                    var opts = {
                        type: BMAP_NAVIGATION_CONTROL_LARGE
                    }
                    map.enableScrollWheelZoom(true);
                    map.addControl(new BMap.NavigationControl(opts));
                    map.centerAndZoom(point, 15);
                    map.addOverlay(marker);

                    // 解决移动端 click事件点击无效
                    map.addEventListener("touchmove", function (e) {
                        map.enableDragging();
                    });
                    //  触摸结束时触发次此事件  此时开启禁止拖动
                    map.addEventListener("touchend", function (e) {
                        map.disableDragging();
                    });
                    // 初始化地图 禁止拖动   注：虽禁止拖动，但是可以出发拖动事件
                    map.disableDragging();

                    // map.addEventListener("click", function (e) {
                    //     var info = new BMap.InfoWindow('', {
                    //         width: 260
                    //     });
                    //     var projection = this.getMapType().getProjection();
                    //     var lngLat = e.point;
                    //
                    //     that.latitude = lngLat.lat;
                    //     that.longitude = lngLat.lng;
                    //
                    //     map.clearOverlays();
                    //     var point = new BMap.Point(lngLat.lng, lngLat.lat);
                    //     var marker = new BMap.Marker(point);
                    //     map.addOverlay(marker);
                    // });
                },
                bindFoundedYear: function (obj) {
                    this.dateValue = obj.date;
                    this.foundedYearShow = false;
                },
                comInfo: function () {
                    showLoading();
                    var that = this;
                    $.post('{yun:}url d=wxapp h=com m=info c=getinfo{/yun}', {
                        rand: Math.random(),
                        source: 'wap'
                    }, function (data) {
                        hideLoading();
                        if (data) {
                            let res = data.data;
                            that.cominfo = res;
                            that.logo = res.logo
                            that.city = res.provinceid ? res.job_city_one + ' ' + res.job_city_two + ' ' + (res.job_city_three ? res.job_city_three : '') : that.city
                            that.provinceid = res.provinceid ? parseInt(res.provinceid) : 0;
                            that.cityid = res.cityid ? parseInt(res.cityid) : 0;
                            that.threecityid = res.three_cityid ? parseInt(res.three_cityid) : 0;
                            that.setPosition = res.setPosition == '1' ? 1 : 0;
                            if (res.x && res.y) {
                                that.longitude = res.x;
                                that.latitude = res.y;
                            }
                            that.address = that.cominfo.address
                            that.supplementData = {
                                sdate: res.sdate,
                                linkmail: res.linkmail,
                                shortname: res.shortname,
                                linkqq: res.linkqq,
                                website: res.website,
                                moneytype: res.moneytype,
                                money: res.money,
                                linkjob: res.linkjob,
                                busstops: res.busstops,
                                infostatus: res.infostatus,
                                welfare: res['arraywelfare']
                            }
                            that.welfareall = res['welfareAll'] ? res['welfareAll'] : [];
                            if (res['arraywelfare'] && res['arraywelfare'].length > 0) {
                                that.welfare = res['arraywelfare'];
                                that.welfareval = res['welfare'];
                            }
                            if (res.moneytype) {
                                if (res.moneytype == 1) {
                                    that.moneytypeIndex = 0;
                                } else if (res.moneytype == 2) {
                                    that.moneytypeIndex = 1;
                                }
                            }
                            if (res.infostatus) {
                                if (res.infostatus == 1) {
                                    that.infostatusIndex = 0;
                                } else if (res.infostatus == 2) {
                                    that.infostatusIndex = 1;
                                }
                            }
                            if (that.canEditor) {
                                if (res.content) {
                                    let a = setInterval(function () {
                                        if (that.editorCtx) {
                                            clearInterval(a);
                                            that.editorCtx.setContents({
                                                html: res.content
                                            })
                                        }
                                    }, 100);
                                } else {
                                    that.cominfo.content = '';
                                }
                            }

                            // 索引赋值
                            let hyIndex = that.hy.id.indexOf(res.hy ? parseInt(res.hy) : 0);
                            that.hyIndex = hyIndex < 0 ? 0 : hyIndex;
                            let prIndex = that.pr.id.indexOf(res.pr ? parseInt(res.pr) : 0);
                            that.prIndex = prIndex < 0 ? 0 : prIndex;
                            let munIndex = that.mun.id.indexOf(res.mun ? parseInt(res.mun) : 0);
                            that.munIndex = munIndex < 0 ? 0 : munIndex;

                            if (res.sdate) {
                                that.foundedYear.forEach(function (val, index) {
                                    if (val.date == res.sdate) {

                                        that.foundedYearIndex = index;
                                    }
                                });
                            }
                            that.islook = true;
                            $('#yunvue').removeClass('none');
                        }
                    }, 'json');
                },
                bindprChange: function (value, index) {
                    this.prIndex = index;
                    this.cominfo.pr = this.pr.id[index];
                    this.prShow = false;
                },
                bindhyChange: function (value, index) {
                    this.hyIndex = index;
                    this.cominfo.hy = this.hy.id[index];
                    this.hyShow = false;
                },
                bindmunChange: function (value, index) {
                    this.munIndex = index;
                    this.cominfo.mun = this.mun.id[index];
                    this.munShow = false;
                },
                bindinfostatusChange: function (value, index) {
                    this.infostatusIndex = index;
                    this.cominfo.infostatus = this.infostatus.id[index];
                    this.lxfsShow = false;
                },
                bindmoneytypeChange: function (value, index) {
                    this.moneytypeIndex = index;
                    this.cominfo.moneytype = this.moneytype.id[index];
                    this.moneyShow = false;
                },
                opendDec: function () {
                    umeditor = UM.getEditor('content', {
                        toolbar: false,
                        elementPathEnabled: false,
                        wordCount: false,
                        autoHeightEnabled: false
                    });

                    let that = this;
                    umeditor.addListener('ready', function () {
                        umeditor.setContent(that.cominfo.content)
                    })
                },
                upDesc: function () {
                    var that = this;

                    var content = umeditor.getContent();
                    if (content != "") {
                        that.cominfo.content = content;
                        that.cominfo.content_t = content.replace(/<\/?.+?>/g, "").replace(/ /g, "");
                    } else {
                        that.cominfo.content = '';
                        that.cominfo.content_t = '';
                    }
                    that.openDec = false;
                },
                openAddress: function () {
                    this.addressShow = true;
                    let that = this;

                    setTimeout(() => {
                        if (!map.bh) {
                            map = new BMap.Map("map_container");
                        }

                        if (that.latitude && that.longitude) {
                            map.centerAndZoom(new BMap.Point(that.longitude, that.latitude), 15);
                            // 初始化marker
                            var point = new BMap.Point(that.longitude, that.latitude);
                            var marker = new BMap.Marker(point);
                            map.addOverlay(marker);
                        } else {
                            map.centerAndZoom(new BMap.Point(116.404, 39.915), 15);
                        }
                        setTimeout(() => {
                            map.addEventListener("click", function (e) {
                                var info = new BMap.InfoWindow('', {
                                    width: 260
                                });
                                var projection = this.getMapType().getProjection();
                                var lngLat = e.point;

                                that.latitude = lngLat.lat;
                                that.longitude = lngLat.lng;

                                map.clearOverlays();
                                // var point = new BMap.Point(lngLat.lng, lngLat.lat);
                                var marker = new BMap.Marker(e.point);
                                map.addOverlay(marker);
                            });
                        }, 500)
                    }, 600)
                },
                bindwelfareChang: function (e) {
                    let that = this,
                        windex = '',
                        index = e.currentTarget.dataset.index,
                        welfareall = that.welfareall,
                        welfare = that.welfare;
                    if (welfareall[index]['ischecked'] != 1) {
                        welfareall[index]['ischecked'] = 1;
                        welfare.push(welfareall[index]['name']);
                    } else {
                        welfareall[index]['ischecked'] = 0;
                        windex = welfare.indexOf(welfareall[index]['name']);

                        if (windex > -1) {
                            welfare.splice(windex, 1);
                        }
                    }

                    that.welfare = welfare;
                    that.welfareval = welfare.join(',');
                    that.welfareall = welfareall;
                },
                bindwelfareAdd: function (e) {
                    let that = this,
                        welfareAdd = that.welfareAdd,
                        welfareall = that.welfareall,
                        welfareval = that.welfareval.split(','),
                        welnameall = [];

                    for (let i in welfareall) {
                        welnameall.push(welfareall[i]['name']);
                    }

                    if ($.trim(welfareAdd)!= '' && welfareAdd.length >= 2 && welfareAdd.length <= 8) {
                        //判断信息是否已经存在
                        if (welnameall.indexOf(welfareAdd) > -1) {
                            showModal('相同福利信息已存在，请重新填写');
                            return;
                        }

                        welfareall.push({
                            'name': welfareAdd,
                            'ischecked': 1
                        });
                        welfareval.push(welfareAdd);

                        that.welfareall = welfareall;
                        that.welfareval = welfareval.join(',');
                        that.welfareAdd = '';
                        that.welid = 'w' + welfareall.length;
                    } else {
                        showModal('请输入2-8个福利字符！');
                    }
                },

                sign: function () {
                    showLoading();
                    var self = this;
                    $.post('{yun:}url d=wxapp h=com m=index c=sign{/yun}', {rand: Math.random()}, function (res) {
                        hideLoading();
                        if (res.error == 1) {
                            showModal(res.msg, function () {
                                self.signstate = 1;
                            });
                            self.getInfo();
                        } else {
                            showModal(res.msg);
                        }
                    }, 'json');
                },
                jobAdd: function () {
                    showLoading();
                    var self = this;
                    $.post('{yun:}url d=wxapp h=com m=index c=addCheck{/yun}', {rand: Math.random()}, function (res) {
                        hideLoading();
                        if (res.error == 1) {
                            showModal(res.msg, function () {
                                self.signstate = 1;
                            });
                            self.getInfo();
                        } else {
                            showModal(res.msg);
                        }
                    }, 'json');
                },
                // 上传头像
                openPhoto: function () {
                    this.photoShow = true
                    
                },
                upComqcode: function() {
                    $("#pic").click();
                },
            }
        });

    // 裁剪logo
    function toAlloyCrop(pic) {
        let yd = yunvue.$data;
        new AlloyCrop({
            image_src: pic,
            width: 200,
            height: 200,
            output: 1,
            ok: function (base64, canvas) {
                yd.newLogo = base64;
                $("#preview").val(base64);
                // $('#showResult').fadeIn();
            },
            cancel: function () {
                // $('#showResult').fadeIn();
            },
            ok_text: '确定',
            cancel_text: '取消'
        });
    }

    // 上传logo
    function photo() {
        let yd = yunvue.$data;
        var uimage = $("#preview").val();
        if (uimage == '') {
            showToast('请选择图片后再提交');
            return false;
        } else {
            var regS = new RegExp("\\+", "gi");
            uimage = uimage.replace(regS, "#");
            showLoading('上传中');
            $.ajax({
                type: 'POST',
                url: '{yun:}url d=wxapp h=com m=info c=savephoto{/yun}',
                cache: false,
                dataType: 'json',
                data: {
                    uimage: uimage,
                    source: 'wap'
                },
                success: function (data) {
                    hideLoading();
                    if (data.error == 1) {
                        showToast(data.msg, 2, function () {
                            yd.logo = yd.newLogo;
                            yd.newLogo = '';
                            $("#preview").val('');
                            // yd.photoShow = false;
                        });
                    } else {
                        showModal(data.msg);
                    }
                }
            });
        }
    }

    function jobAddress(e) {
        let yd = yunvue.$data;
        try {
            let provinceid = yd.provinceid,
                cityid = yd.cityid,
                three_cityid = yd.threecityid,
                address = e.address.value,
                latitude = yd.latitude,
                longitude = yd.longitude;
            if (provinceid == 0) {
                showModal('请选择所在城市');
                return false;
            }
            if (ct[provinceid]) {
                if (cityid == 0) {
                    showModal('请精确选择所在城市');
                    return false;
                }
            }
            if (address.length == 0) {
                showModal('请填写企业地址');
                return false;
            }

            if (yd.setPosition == 1 && latitude.length == 0 && longitude.length == 0) {
                showModal('请设置企业地图');
                return false;
            }

            yd.addressShow = false;
        } catch (e) {}

        return false; // 阻止form提交
    }

    function isQQ(QQ) {
        var QQreg = /[1-9][0-9]{4,}/;
        if (QQreg.test(QQ)) {
            return true;
        } else {
            return false;
        }
    }

    /**
     * 判断网址格式是否正确
     */
    function check_url(obj) {
        var Reg =
            /^((([hH][tT][tT][pP][sS]?|[fF][tT][pP])\:\/\/)?([\w\.\-]+(\:[\w\.\&%\$\-]+)*@)?((([^\s\(\)\<\>\\\"\.\[\]\,@;:]+)(\.[^\s\(\)\<\>\\\"\.\[\]\,@;:]+)*(\.[a-zA-Z]{2,4}))|((([01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}([01]?\d{1,2}|2[0-4]\d|25[0-5])))(\b\:(6553[0-5]|655[0-2]\d|65[0-4]\d{2}|6[0-4]\d{3}|[1-5]\d{4}|[1-9]\d{0,3}|0)\b)?((\/[^\/][\w\.\,\?\'\\\/\+&%\$#\=~_\-@]*)*[^\.\,\?\"\'\(\)\[\]!;<>{}\s\x7F-\xFF])?)$/;
        if (Reg.test(obj)) {
            return true;
        } else {
            return false;
        }
    }

    function formSubmit(e) {
        var that = this,
            yd = yunvue.$data,
            linkmail = e.linkmail.value,
            linkqq = e.linkqq.value,
            website = e.website.value;

        if (linkmail.length > 0) {
            if (check_email(linkmail) == false) {
                showModal('电子邮箱格式错误');
                return false;
            }
        }
        if (linkqq.length > 0) {
            if (isQQ(linkqq) == false) {
                showModal('QQ格式错误');
                return false;
            }
        }
        if (website.length > 0) {
            if (check_url(website) == false) {
                showModal('网址格式错误');
                return false;
            }
        }
        try {
            let formData = {
                sdate: e.sdate.value,
                linkmail: e.linkmail.value,
                shortname: e.shortname.value,
                linkqq: e.linkqq.value,
                website: e.website.value,
                moneytype: e.moneytype.value,
                money: e.money.value,
                linkjob: e.linkjob.value,
                busstops: e.busstops.value,
                infostatus: e.infostatus.value,
                welfare: e.welfare.value,
            };

            yd.supplementData = formData;
        } catch (e) {}

        yd.supInfoShow = false;
        return false; // 阻止form提交
    }

    function formSubmitinfo(e) {
        var that = this,
            yd = yunvue.$data,
            obj = {
                name: e.name.value,
                hy: e.hy.value,
                pr: e.pr.value,
                mun: e.mun.value,
                linkman: e.linkman.value,
                linktel: e.linktel.value,
                linkphone: e.linkphone.value,
            };
        try {
            if (obj.name.length == 0) {
                showModal('请填写企业名称');
                return false;
            }
            if (obj.hy == 0) {
                showModal('请选择从事行业');
                return false;
            }
            if (obj.pr == 0) {
                showModal('请选择企业性质');
                return false;
            }
            if (obj.mun == 0) {
                showModal('请选择企业规模');
                return false;
            }
            obj.provinceid = yd.provinceid
            obj.cityid = yd.cityid
            obj.three_cityid = yd.threecityid
            obj.address = yd.cominfo.address

            if (obj.provinceid == 0) {
                showModal('请选择所在城市');
                return false;
            }
            if (ct[obj.provinceid]) {
                if (obj.cityid == 0) {
                    showModal('请精确选择所在城市');
                    return false;
                }
            }
            if (obj.address.length == 0) {
                showModal('请填写企业地址');
                return false;
            }

            if (yd.setPosition == 1 && yd.latitude.length == 0 && yd.longitude.length == 0) {
                showModal('请设置企业地图');
                return false;
            }

            if (obj.linkman.length == 0) {
                showModal('请填写联系人');
                return false;
            }

            if (obj.linktel.length == 0) {
                showModal('请填写联系手机');
                return false;
            }

            if (obj.linktel.length > 0) {
                if (isjsMobile(obj.linktel) == false) {
                    showModal('联系手机格式错误');
                    return false;
                }
            }
            if (obj.linkphone.length > 0) {
                if (isjsTell(obj.linkphone) == false) {
                    showModal('联系电话格式错误');
                    return false;
                }
            }

            let content = yd.cominfo.content.replace(/<[^>]+>/g, "");
            if (content.trim() == '') {
                showModal('请填写企业简介');
                return false;
            }

            // 处理下一步
            yd.firstData = obj;

            let formData = {};
            formData.content = yd.cominfo.content;
            formData.x = yd.longitude;
            formData.y = yd.latitude;
            formData.source = 'wap';

            Object.assign(formData, yd.firstData, yd.supplementData);
            let comqcode = $("#comqcode").val();
            if (comqcode) {
                formData.preview = comqcode;
            }

            showLoading('保存中');
            $.post('{yun:}url d=wxapp h=com m=info c=saveinfo{/yun}', formData, function (data) {
                hideLoading();
                if (data.error == 1) {
                    showModal(data.msg, function () {
                        navigateTo('index.php');
                        // history.go(-1)
                    });
                } else {
                    showModal(data.msg);
                }
            }, 'json')
        } catch (err) {
        }

        return false;
    }
</script>
{yun:}include file="$wapstyle/member/public/remind.htm"{/yun}
<style>
    .jstextarea_tck_c_between {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .xztextarea_tck_tit {
        font-size: 18px;
        color: #333333;
        font-weight: bold;
    }

    .jstextarea_tck_c_between_r {
        width: 22px;
        height: 22px;
    }

    .flbutton {
        display: flex;
        width: 100%;
        box-sizing: border-box;
        flex-wrap: wrap;
    }

    .flbutton_tabh {
        background: #F6F6F6;
        font-size: 13px;
        line-height: 30px;
        padding: 0 18px;
        color: #333333;
        text-align: center;
        display: inline-block;
        margin-right: 7px;
        border-radius: 15px;
        margin-top: 15px;
    }

    .flbutton_tab {
        background: rgba(39, 120, 248, 0.1);
        color: #2778F8;
    }
</style>